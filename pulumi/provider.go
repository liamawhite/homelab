package main

import (
	"os"

	"github.com/pulumi/pulumi-kubernetes/sdk/v4/go/kubernetes"
	"github.com/pulumi/pulumi/sdk/v3/go/pulumi"
)

// NewProvider creates a Kubernetes provider from the kubeconfig file
// generated by the CLI at ../kubeconfig
func NewProvider(ctx *pulumi.Context) (*kubernetes.Provider, error) {
	// Read kubeconfig from file
	kubeconfigPath := "../kubeconfig"
	kubeconfigContent, err := os.ReadFile(kubeconfigPath)
	if err != nil {
		return nil, err
	}

	// Create Kubernetes provider
	provider, err := kubernetes.NewProvider(ctx, "k8s", &kubernetes.ProviderArgs{
		Kubeconfig: pulumi.String(string(kubeconfigContent)),
	})
	if err != nil {
		return nil, err
	}

	return provider, nil
}
